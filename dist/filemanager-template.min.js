!function(){"use strict";var e,t;window.fmWrapper=document.querySelector(".fm-wrapper"),Element.prototype.closest||((e=Element.prototype).matches||(e.matches=e.msMatchesSelector||e.webkitMatchesSelector),e.closest=function(e){var t=this;if(t.matches(e))return t;for(;t.parentElement;){var r=t.parentElement;if(r.matches(e))return r;t=t.parentElement}}),NodeList.prototype.forEach||(NodeList.prototype.forEach=function(e,t){for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),"classList"in HTMLElement.prototype&&!("forEach"in document.createElement("_").classList)&&(DOMTokenList.prototype.forEach=function(e,t){for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),"classList"in document.createElement("_")||((t=function(e){e.className.split(" ").forEach(function(e){this.push(e)}.bind(this)),this._update=function(){e.setAttribute("class",this.join(" "))}}).prototype=Array.prototype,classListProto=t.prototype,classListProto.add=function(){for(var e=0;e<arguments.length;e++)this.contains(arguments[e])||this.push(arguments[e]);this._update()},classListProto.remove=function(){for(var e=0;e<arguments.length;e++)for(var t=0;t<this.length;t++)this[t]===arguments[e]&&this.splice(t,1);this._update()},classListProto.item=function(e){return this[e]},classListProto.contains=function(e){return-1!==this.indexOf(e)},classListProto.toggle=function(e){this.contains(e)?this.remove(e):this.add(e)},Object.defineProperty(window.Element.prototype,"classList",{get:function(){return new t(this)},enumerable:!0,configurable:!0}));var o=[0,0,0],n={read:4,write:2,execute:1};function r(e){var t,r=fmWrapper.querySelector(".theme-option[data-theme="+e+"]");r&&(fmWrapper.querySelectorAll(".theme-option").forEach(function(e){e.classList.remove("selected")}),r.classList.add("selected"),t=[],fmWrapper.querySelectorAll(".theme-option").forEach(function(e){t.push(e.getAttribute("data-theme"))}),fmWrapper.classList.forEach(function(e){t.forEach(function(e){fmWrapper.classList.remove(e)})}),fmWrapper.classList.add(e),localStorage.setItem("fm-theme",e))}fmWrapper.querySelectorAll(".perm-table .checkbox").forEach(function(e){e.addEventListener("change",function(){fmWrapper.querySelector(".numeric-chmod").textContent=function(){var e=this.getAttribute("data-group"),t=this.getAttribute("data-action"),r=this.querySelector('input[type="checkbox"]').checked;switch(e){case"owner":r?o[0]+=n[t]:o[0]-=n[t];break;case"group":r?o[1]+=n[t]:o[1]-=n[t];break;case"others":r?o[2]+=n[t]:o[2]-=n[t]}return"0"+o.join("")}.call(this)})}),localStorage.getItem("fm-theme")&&r(localStorage.getItem("fm-theme")),fmWrapper.querySelectorAll(".theme-option").forEach(function(e){e.addEventListener("click",function(){r(this.getAttribute("data-theme"))})}),window.addEventListener("DOMContentLoaded",function(){fmWrapper.querySelectorAll(".loading").forEach(function(e){e.classList.remove("loading")})});var i=fmWrapper.querySelector("#fm-editor"),c=i.querySelector(".line-numbers"),a=i.querySelector(".content-area"),l=i.querySelector(".pending");function s(){var e=a.value.split("\n").length;c.innerHTML="";for(var t,r,o=0;o<e;o++)t=o+1,r=void 0,(r=document.createElement("span")).textContent=t,c.appendChild(r);a.style.height=window.getComputedStyle(c).getPropertyValue("height")}["input","paste"].forEach(function(e){a.addEventListener(e,s)});function f(e,r,o){document.addEventListener(e,function(e){e.target.matches(r)&&o(e);for(var t=e.target.parentElement;null!==t;)t.matches(r)&&o(e),t=t.parentElement})}s(),window.fmEditor=new function(){this.set=function(e){return a.value=e,s(),this},this.append=function(e){return a.value+=e,s(),this},this.get=function(){return a.value},this.clear=function(){return a.value="",s(),this},this.showLoading=function(){return l.classList.add("show"),this},this.hideLoading=function(){return l.classList.remove("show"),this}},fmWrapper.querySelector(".toggle-slidebar").addEventListener("click",function(){document.querySelector(".slidebar").classList.toggle("show")}),fmWrapper.addEventListener("click",function(e){(e.target.closest(".slidebar")||e.target.closest(".toggle-slidebar")||e.target.closest(".settings-modal")||e.target.closest(".modal-overlay"))&&!e.target.closest('.settings-modal button[data-close="modal"]')||fmWrapper.querySelector(".slidebar").classList.remove("show")});var u=fmWrapper.querySelector(".files-table"),d=u.querySelector(".files-select-all"),m=fmWrapper.querySelector(".toolbar .files-select"),p=fmWrapper.querySelector(".toolbar .files-unselect"),h=fmWrapper.querySelectorAll(".right-buttons *[data-action]");function y(){return u.querySelectorAll(".file-item")}function g(){return u.querySelectorAll(".file-item.selected")}function v(){return u.querySelectorAll('.file-item .checkbox input[type="checkbox"]')}function L(t){var e=v();d.checked=t,[].forEach.call(e,function(e){e.checked=t,e.closest(".file-item").classList[t?"add":"remove"]("selected")})}function E(t,r){var o={file:[],dir:["edit","download"],collection:["edit","rename","move","download","permissions","info"]};h.forEach(function(e){r&&-1!==o[r].indexOf(e.getAttribute("data-action"))?e.disabled=!0:e.disabled=!t})}function S(){var e=g(),t=y();d.checked=t.length===e.length}f("click",".files-table .file-item",function(e){var t,r,o;e.target.closest(".checkbox")||(e.shiftKey||e.ctrlKey||(t=g(),r=v(),t.forEach(function(e){e.classList.remove("selected")}),r.forEach(function(e){e.checked=!1})),d.checked=!1,(o=e.target.closest(".file-item")).classList.add("selected"),E(o.querySelector('.checkbox input[type="checkbox"]').checked=!0,o.closest(".file-item").getAttribute("data-type")),S())}),f("change",'.file-item .checkbox input[type="checkbox"]',function(e){e.target.closest(".file-item").classList.toggle("selected");var t=g();1<t.length?E(!0,"collection"):1===t.length?E(!0,t[0].getAttribute("data-type")):E(!1),S()}),d.addEventListener("change",function(){this.checked?(L(!0),E(!0,"collection")):(L(!1),E(!1))}),m.addEventListener("click",function(){L(!0),E(!0,"collection")}),p.addEventListener("click",function(){L(!1),E(!1)}),fmWrapper.addEventListener("click",function(e){(e.target.closest(".files-table")||e.target.closest(".files-select")||e.target.closest(".files-unselect")||e.target.closest(".footer")||e.target.closest(".modal"))&&!e.target.closest('*[data-close="modal"]')||(L(!1),E(!1))}),window.addEventListener("keyup",function(e){var t,r,o,n,i="Up"===e.key||"ArrowUp"===e.key,c="Down"===e.key||"ArrowDown"===e.key,a=y();!i&&!c||fmWrapper.querySelector(".modal.show")||(1<=(t=function(){for(var e=y(),t=fmWrapper.querySelector(".files-table .file-item.selected"),r=0;r<e.length;r++)if(e[r]===t)return r+1;return-1}())&&t!==a.length&&c?t++:1<t&&i?t--:t=1===t&&i?a.length:1,L(!1),r=t,o=fmWrapper.querySelector(".files-table .file-item:nth-child("+r+")"),n=o.querySelector('.checkbox input[type="checkbox"]'),E(!0,o.getAttribute("data-type")),o.classList.add("selected"),n.checked=!0)});var q=document.createElement("div");q.classList.add("modal-overlay"),fmWrapper.appendChild(q),fmWrapper.querySelectorAll("*[data-modal]").forEach(function(e){e.addEventListener("click",function(){fmWrapper.querySelector(this.getAttribute("data-modal")).classList.add("show"),q.classList.add("show")})}),fmWrapper.querySelectorAll('*[data-close="modal"]').forEach(function(e){e.addEventListener("click",function(){this.closest(".modal").classList.remove("show"),q.classList.remove("show")})});var b=fmWrapper.querySelector("#moveFileModal"),k=b.querySelectorAll(".files-list .item");k.forEach(function(e){e.addEventListener("click",function(t){[function(e){this===e.target.closest(".dir-item")&&(k.forEach(function(e){e.classList.remove("selected")}),this.classList.add("selected"))},function(e){var t=b.querySelector(".destination");if(this===e.target.closest(".dir-item")){var r=this,o=r.querySelector(".name").textContent;for(r=r.parentElement.parentElement;r.classList.contains("dir-item");)o=r.querySelector(".name").textContent+"/"+o,r=r.parentElement.parentElement;t.textContent=o}}].forEach(function(e){e.call(this,t)}.bind(this))})}),fmWrapper.querySelector('*[data-action="move"]').addEventListener("click",function(){var e;e=fmWrapper.querySelector(".files-table .file-item.selected .file-name"),fmWrapper.querySelector("#moveFileModal .moving-to .source").textContent=e.textContent}),fmWrapper.querySelector('*[data-action="remove"]').addEventListener("click",function(){var e=fmWrapper.querySelectorAll(".files-table .file-item.selected"),t=fmWrapper.querySelector("#removeFileModal .filename");1===e.length?t.textContent=e[0].querySelector(".file-name").textContent:t.textContent="("+e.length+") files"}),fmWrapper.querySelector('*[data-action="rename"]').addEventListener("click",function(){var e=fmWrapper.querySelector(".files-table .file-item.selected");fmWrapper.querySelector("#renameFileModal .name-for").textContent=e.querySelector(".file-name").textContent}),fmWrapper.querySelector('*[data-action="permissions"]').addEventListener("click",function(){var e=fmWrapper.querySelector(".files-table .file-item.selected");fmWrapper.querySelector("#permissionsModal .filename").textContent=e.querySelector(".file-name").textContent})}();
